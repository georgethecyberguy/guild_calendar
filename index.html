<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Guild Calendar 2025</title>
  <style>
    :root {
      --bg: #000;
      --fg: #fff;
      --panel-bg: #111;
      --cell-bg: #000;
      --header-bg: #111;
      --border: #333;
      --highlight: #ffcc00;
      --modal-bg: rgba(0,0,0,0.8);
      --transition: 0.3s ease;
    }
    .light-mode {
      --bg: #fff;
      --fg: #000;
      --panel-bg: #f7f7f7;
      --cell-bg: #fff;
      --header-bg: #eee;
      --border: #ccc;
      --highlight: #007aff;
      --modal-bg: rgba(255,255,255,0.8);
    }
    * { transition: background var(--transition), color var(--transition), border-color var(--transition); }
    body { font-family: Arial, sans-serif; background: var(--bg); color: var(--fg); margin: 0; padding: 0; }
    header { display: flex; justify-content: center; align-items: center; padding: 10px; background: var(--header-bg); }
    header button, header span { background: none; border: none; color: var(--fg); font-size: 18px; margin: 0 10px; cursor: pointer; }
    #settingsBtn { font-size: 18px; }
    #modeBtn { font-size: 18px; }
    #settingsPanel { overflow: hidden; max-height: 0; background: var(--panel-bg); padding: 0 10px; transition: max-height var(--transition); }
    #settingsPanel.open { max-height: 200px; padding: 10px; }
    .controls { display: none; }
    #calendar { display: grid; grid-template-columns: repeat(7,1fr); gap: 1px; background: var(--bg); padding: 1px; }
    .day-header { background: var(--panel-bg); text-align: center; padding: 8px; font-weight: bold; }
    .day-cell { background: var(--cell-bg); border: 1px solid var(--border); padding: 8px; position: relative; cursor: pointer; }
    .day-cell.today { border-color: var(--highlight); animation: pulse 1s; }
    .day-cell .count { position: absolute; top: 4px; right: 4px; background: var(--panel-bg); padding: 2px 6px; border-radius: 4px; font-size: 12px; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--modal-bg); justify-content: center; align-items: center; opacity: 0; transition: opacity var(--transition); }
    .modal.show { display: flex; opacity: 1; }
    .modal-content { background: var(--panel-bg); padding: 20px; border-radius: 8px; width: 90%; max-width: 400px; transform: translateY(-10px); transition: transform var(--transition); }
    .modal.show .modal-content { transform: translateY(0); }
    .modal-content h3 { margin-top: 0; }
    .modal-content .entry { display: flex; gap: 4px; margin-bottom: 6px; }
    .modal-content select, .modal-content input, .modal-content textarea { background: var(--cell-bg); color: var(--fg); border: 1px solid var(--border); }
    .modal-content select, .modal-content input { padding: 4px; font-size: 14px; }
    .modal-content textarea { width: 100%; height: 60px; padding: 6px; font-size: 14px; margin-bottom: 10px; }
    .modal-content button { padding: 6px 12px; margin-right: 10px; background: var(--border); color: var(--fg); border: none; cursor: pointer; }
    @keyframes pulse { 0% { box-shadow: 0 0 0px var(--highlight); } 50% { box-shadow: 0 0 10px var(--highlight); } 100% { box-shadow: 0 0 0px var(--highlight); } }
  </style>
</head>
<body>
  <header>
    <button id="prevBtn">‚Üê</button>
    <span id="monthLabel"></span>
    <button id="nextBtn">‚Üí</button>
    <button id="settingsBtn">‚öôÔ∏è</button>
    <button id="modeBtn">üåì</button>
  </header>
  <div id="settingsPanel">
    <label>Slots: <input id="slotCount" type="number" min="1" max="50" value="10" /></label>
    <label>Hours: <input id="startHour" type="time" value="18:00" /> - <input id="endHour" type="time" value="23:00" /></label>
    <button id="exportBtn">Share</button>
  </div>
  <div id="calendar"></div>
  <div id="modal" class="modal">
    <div class="modal-content">
      <h3 id="modalDate"></h3>
      <div id="modalEntries"></div>
      <textarea id="modalNotes" placeholder="Notes"></textarea>
      <button id="saveBtn">Save</button>
      <button id="closeBtn">Close</button>
    </div>
  </div>
  <script>
    // Theme toggle
    document.getElementById('modeBtn').onclick = () => document.body.classList.toggle('light-mode');
    // Data
    const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    const classOptions = ['üêâ','üî•','üõ°Ô∏è','üèπ','üôè','ü•∑','ü™Ñ','üå©Ô∏è','üõê','üßò','‚ò†Ô∏è','üëø','üßë‚Äçüíª'];
    const year = 2025;
    let currentMonth = new Date().getFullYear()===year ? new Date().getMonth() : 0;
    // Elements
    const calendarEl = document.getElementById('calendar');
    const monthLabel = document.getElementById('monthLabel');
    const settingsPanel = document.getElementById('settingsPanel');
    // Toggle settings
    document.getElementById('settingsBtn').onclick = () => settingsPanel.classList.toggle('open');
    // Navigation
    document.getElementById('prevBtn').onclick = () => { currentMonth = (currentMonth + 11) % 12; renderCalendar(); };
    document.getElementById('nextBtn').onclick = () => { currentMonth = (currentMonth + 1) % 12; renderCalendar(); };
    // Export (JSON)
    document.getElementById('exportBtn').onclick = () => {
      const data = {};
      document.querySelectorAll('.day-cell').forEach(cell => {
        const day = block = cell.textContent.trim().split('\n')[0];
        if (!day || isNaN(day)) return;
        const key = `${year}-${currentMonth+1}-${day}`;
        data[key] = JSON.parse(localStorage.getItem(key) || 'null');
      });
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `guild_${monthNames[currentMonth]}2025.json`;
      link.click();
    };
    // Render calendar grid
    function renderCalendar() {
      calendarEl.innerHTML = '';
      monthLabel.textContent = monthNames[currentMonth] + ' ' + year;
      // Headers
      ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d => {
        const hd = document.createElement('div');
        hd.className = 'day-header';
        hd.textContent = d;
        calendarEl.appendChild(hd);
      });
      // Days
      const firstDay = new Date(year, currentMonth, 1).getDay();
      const daysInMonth = new Date(year, currentMonth + 1, 0).getDate();
      for (let i = 0; i < firstDay; i++) {
        const empty = document.createElement('div');
        empty.className = 'day-cell';
        calendarEl.appendChild(empty);
      }
      for (let day = 1; day <= daysInMonth; day++) {
        const key = `${year}-${currentMonth+1}-${day}`;
        const cell = document.createElement('div');
        cell.className = 'day-cell';
        if (new Date().getFullYear() === year && new Date().getMonth() === currentMonth && new Date().getDate() === day) {
          cell.classList.add('today');
        }
        cell.textContent = day;
        // Count
        const count = document.createElement('div');
        count.className = 'count';
        const saved = JSON.parse(localStorage.getItem(key) || 'null');
        count.textContent = saved ? (saved.entries || []).length + ' ‚úì' : '0 ‚úì';
        cell.appendChild(count);
        // Click modal
        cell.onclick = () => openModal(key, day);
        calendarEl.appendChild(cell);
      }
      // Trailing blanks
      const totalCells = calendarEl.querySelectorAll('.day-cell').length;
      for (let i = totalCells; i < 35; i++) {
        const extra = document.createElement('div');
        extra.className = 'day-cell';
        calendarEl.appendChild(extra);
      }
    }
    // Modal
    function openModal(key, day) {
      const modal = document.getElementById('modal');
      modal.classList.add('show');
      document.getElementById('modalDate').textContent = monthNames[currentMonth] + ' ' + day + ', ' + year;
      const entriesWrap = document.getElementById('modalEntries');
      entriesWrap.innerHTML = '';
      const data = JSON.parse(localStorage.getItem(key) || 'null') || { entries: [], notes: '' };
      document.getElementById('modalNotes').value = data.notes;
      const slots = parseInt(document.getElementById('slotCount').value, 10);
      const [h0, m0] = document.getElementById('startHour').value.split(':').map(Number);
      const [h1, m1] = document.getElementById('endHour').value.split(':').map(Number);
      for (let i = 0; i < slots; i++) {
        const ent = document.createElement('div'); ent.className = 'entry';
        const timeEl = document.createElement('select'); timeEl.className = 'time-input';
        for (let h = h0; h < h1; h++) {
          const opt = document.createElement('option');
          const h12 = h % 12 === 0 ? 12 : h % 12;
          const ampm = h < 12 ? 'AM' : 'PM';
          opt.value = `${h12}:00 ${ampm}`;
          opt.textContent = opt.value;
          timeEl.appendChild(opt);
        }
        const clsEl = document.createElement('select');
        const blank = document.createElement('option'); blank.value = ''; blank.textContent = '-'; clsEl.appendChild(blank);
        classOptions.forEach(c => { const o = document.createElement('option'); o.value = c; o.textContent = c; clsEl.appendChild(o); });
        const nmEl = document.createElement('input'); nmEl.type = 'text'; nmEl.placeholder = 'Name';
        if (data.entries[i]) {
          timeEl.value = data.entries[i].time;
          clsEl.value = data.entries[i].cls;
          nmEl.value = data.entries[i].nm;
        }
        ent.appendChild(timeEl);
        ent.appendChild(clsEl);
        ent.appendChild(nmEl);
        entriesWrap.appendChild(ent);
      }
      document.getElementById('saveBtn').onclick = () => saveModal(key);
    }
    function saveModal(key) {
      const entries = Array.from(document.getElementById('modalEntries').children).map(ent => ({
        time: ent.children[0].value,
        cls: ent.children[1].value,
        nm: ent.children[2].value
      })).filter(e => e.nm);
      const notes = document.getElementById('modalNotes').value;
      localStorage.setItem(key, JSON.stringify({ entries, notes }));
      document.getElementById('modal').classList.remove('show');
      renderCalendar();
    }
    document.getElementById('closeBtn').onclick = () => document.getElementById('modal').classList.remove('show');
    // Init slots/hours defaults
    if (!localStorage.getItem('config')) localStorage.setItem('config', JSON.stringify({ slots:10, start:'18:00', end:'23:00' }));
    const cfg = JSON.parse(localStorage.getItem('config'));
    document.getElementById('slotCount').value = cfg.slots;
    document.getElementById('startHour').value = cfg.start;
    document.getElementById('endHour').value = cfg.end;
    document.getElementById('slotCount').onchange = document.getElementById('startHour').onchange = document.getElementById('endHour').onchange = () => {
      localStorage.setItem('config', JSON.stringify({
        slots: parseInt(document.getElementById('slotCount').value, 10),
        start: document.getElementById('startHour').value,
        end: document.getElementById('endHour').value
      }));
      renderCalendar();
    };
    renderCalendar();
  </script>
</body>
</html>
